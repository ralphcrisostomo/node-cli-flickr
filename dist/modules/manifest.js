"use strict";var Manifest,async,fs,mixin,request;request=require("superagent"),fs=require("fs"),mixin=require("./mixin"),async=require("async"),Manifest=function(){function n(){this.manifest=[]}return n.prototype._getUserId=function(n,e){return function(t){return function(t){return n.people.findByUsername({api_key:process.env.FLICKR_API_KEY,username:e},function(n,e){return t(n,e)})}}(this)},n.prototype._downloadManifest=function(n,e,t,i){var r,o;return o=500,r=e.username._content,n.people.getPhotos({api_key:process.env.FLICKR_API_KEY,user_id:e.id,per_page:o,page:t},function(o){return function(s,a){var u,f,l;return s?s:(u=null!=(l=a.photos)?l.photo:void 0,null!=u&&u.forEach(function(n){return o.manifest.push({id:parseInt(null!=n?n.id:void 0),name:null!=n?n.title:void 0,status:"created"})}),mixin.write("cyan","\nDownloading manifest... "+o.manifest.length+" of "+(null!=a?a.photos.total:void 0)+"\r"),o.manifest.length!==a.photos.total?o._downloadManifest(n,e,t+1,i):(mixin.write("cyan","\n------------------\n"),mixin.write("green","\nDownloading manifest : done"),mixin.write("blue","\nWriting `.manifest.json`..."),f=process.cwd()+"/"+r+"/.manifest.json",console.log(f),fs.writeFile(f,JSON.stringify(o.manifest,null,4),function(n){return mixin.write("green","\nWriting `.manifest.json` : done"),i(n,o.manifest)})))}}(this))},n.prototype.create=function(n,e){return function(t){return function(i){return async.waterfall([t._getUserId(n,e)],function(e,r){var o;return o=null!=r?r.user:void 0,mixin.write("blue","\nCreating `.manifest.json`..."),mixin.write("cyan","\n\n------------------"),t._downloadManifest(n,o,1,i)})}}(this)},n}(),module.exports=Manifest;